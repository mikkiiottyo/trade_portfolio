{% extends "base.html" %}

{% block title %}Home Page{% endblock %}

{% block content %}
<h1>Stock Data for {{ stock_symbol }}</h1>

{% if error_message %}
    <p class="text-danger">Error: {{ error_message }}</p>
{% endif %}

{% if stock_symbol and 'Invalid Search' not in stock_symbol %}
    <div>
        {{ graph_html|safe }}
    </div>
{% else %}
    <p>This is mock data for a made-up stock.</p>
{% endif %}


<form method="get" action="/">
    <input type="text"
     name="stock_symbol"
     placeholder="Enter Stock or Cryptocurrency (e.g., AAPL, Bitcoin)" 
     value="{{ stock_symbol }}">
    <button type="submit">Search</button>
</form>

<hr>

{% if user.is_authenticated %}
<p><strong>Your Balance:</strong> ${{ user_balance }}</p>
    <h2>Trade {{ stock_symbol }}</h2>

    <form method="post" action="{% url 'trade_view' %}">
        {% csrf_token %}
        <input type="hidden" name="symbol" value="{{ stock_symbol }}">

        <div class="mb-3">
            <label for="sharesInput" class="form-label">Number of Shares</label>
            <input type="number" name="shares" id="sharesInput" class="form-control" min="1" required>
        </div>

        <input type="hidden" name="action" id="actionInput">


        <div class="btn-group">
            <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                Trade Options
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a class="dropdown-item trade-option" href="#" data-action="BUY">Buy</a>
                </li>
                <li>
                    <a class="dropdown-item trade-option" href="#" data-action="SELL">Sell</a>
                </li>
            </ul>
        </div>
        <p id="selectedAction" class="mt-2"><strong>Selected Action:</strong> None</p>
        <button type="submit" class="btn btn-success mt-2">Submit</button>
    </form>

    {% if error %}
        <div class="alert alert-danger mt-3">{{ error }}</div>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tradeOptions = document.querySelectorAll('.trade-option');
            const actionInput = document.getElementById('actionInput');
            const selectedActionDisplay = document.getElementById('selectedAction');
    
            tradeOptions.forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();
                    const action = this.getAttribute('data-action');
                    actionInput.value = action;
                    selectedActionDisplay.textContent = `Selected Action: ${action}`;    
                });
            });
    
            document.querySelector('form').addEventListener('submit', function (e) {
                if (!actionInput.value) {
                    e.preventDefault();
                    alert('Please select a trade action: Buy, Sell, or Trade.');
                }
            });
        });
    </script>
{% else %}
    <p><a href="{% url 'login' %}">Log in</a> to trade stocks.</p>
{% endif %}

{% endblock %}